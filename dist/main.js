(()=>{var t={677:t=>{t.exports=class{constructor(){this.intensity=0}setIntensity(t){this.intensity=t}}},336:(t,e,s)=>{const i=s(435);t.exports=class{constructor(){this.cameraPosition=new i,this.imagePlaneDist=0,this.fov=0}setCameraPosition(t){this.cameraPosition=t}setImagePlaneDistance(t){this.imagePlaneDist=t}setFOV(t){this.fov=t}}},599:t=>{t.exports=class{constructor(t,e=0,s=0,i=0,n=0,a=0){this.diffuseColor=t,this.specularExponent=e,this.kd=s,this.ks=i,this.ka=n,this.kr=a}}},548:(t,e,s)=>{const i=s(435);t.exports=class{constructor(t,e){this.position=t,this.intensity=e}getDirection(t){let e=i.subV(this.position,t);return e.normalize(),e}}},446:(t,e,s)=>{s(435),t.exports=class{constructor(t,e){this.origin=t,this.direction=e}}},74:(t,e,s)=>{const i=s(435),n=s(446),a=s(652);t.exports=class{constructor(t){this.scene=new a,this.canvas=t,this.enableShadow=!1,this.AA=!1,this.maxReflectionDepth=0}enableShadows(t){this.enableShadow=t}enableAA(t){this.AA=t}setMaxReflectionDepth(t){this.maxReflectionDepth=t}getHalfwayDirection(t,e){return i.addV(e,t)}getDistance(t,e){return i.subV(t,e).norm()}inShadow(t,e,s){let i=new n(t,e);for(let t of this.scene.objects)if(t.hit(i,1e-4)<s)return!0;return!1}shadePhong(t,e,s,n){let a,r,o,c,l=n.direction.negate(),h=0,d=0;for(let n of this.scene.lights)a=n.getDirection(e),r=this.getDistance(n.position,e),o=i.dotProduct(a,s),this.enableShadow&&this.inShadow(e,a,r)||o<0||(c=this.getReflectionDirection(a,s),c.normalize(),h+=t.kd*n.intensity*o,d+=t.ks*n.intensity*Math.pow(Math.max(0,i.dotProduct(c,l)),t.specularExponent));let u=new i(255,255,255),m=i.multiplyScalar(t.diffuseColor,h),g=i.multiplyScalar(u,d),w=i.multiplyScalar(t.diffuseColor,t.ka*this.scene.ambient.intensity);return i.addV(w,i.addV(m,g))}shadeBlinnPhong(t,e,s,n){let a,r,o=n.direction.negate(),c=0,l=0,h=i.multiplyScalar(t.diffuseColor,t.ka*this.scene.ambient.intensity);for(let n of this.scene.lights)a=i.subV(n.position,e),a.normalize(),r=this.getHalfwayDirection(a,o),r.normalize(),c+=t.kd*n.intensity*Math.max(0,i.dotProduct(a,s)),l+=t.ks*n.intensity*Math.pow(Math.max(0,i.dotProduct(r,s)),t.specularExponent);let d=i.addV(i.multiplyScalar(t.diffuseColor,c),i.multiplyScalar(new i(255,255,255),l));return d=i.addV(d,h),d}getClosestIntersection(t,e){let s=1/0,i=null;for(let n of this.scene.objects){let a=n.hit(t,e);a<s&&(s=a,i=n)}return{root:s,closestObject:i}}getReflectionDirection(t,e){let s=t.negate(),n=i.dotProduct(t,e);return i.addV(i.multiplyScalar(e,2*n),s)}traceRay(t,e,s){let a=this.getClosestIntersection(t,e);if(a.root>1e3)return this.scene.backgroundColor;let r=i.addV(t.origin,i.multiplyScalar(t.direction,a.root)),o=i.subV(r,a.closestObject.center);o.normalize();let c=this.shadePhong(a.closestObject.material,r,o,t),l=a.closestObject.material.kr;if(s>=this.maxReflectionDepth||l<=0)return c;let h=new n(r,this.getReflectionDirection(t.direction.negate(),o)),d=this.traceRay(h,1e-4,s+1);return i.addV(c,i.multiplyScalar(d,l))}setPixelColor(t,e,s,i,n){let a=4*(i*n+s);e.data[a]=t.x,e.data[a+1]=t.y,e.data[a+2]=t.z,e.data[a+3]=255}genCameraRayAA(t,e,s,a,r,o,c,l){let h=((t+(o+Math.random())/l)/a*2-1)*Math.tan(this.scene.camera.fov/2)*s,d=(1-(e+(c+Math.random())/l)/r*2)*Math.tan(this.scene.camera.fov/2),u=new i(h,d,this.scene.camera.imagePlaneDist);return new n(this.scene.camera.cameraPosition,i.subV(u,this.scene.camera.cameraPosition))}genCameraRay(t,e,s,a,r){let o=((t+.5)/a*2-1)*Math.tan(this.scene.camera.fov/2)*s,c=(1-(e+.5)/r*2)*Math.tan(this.scene.camera.fov/2),l=new i(o,c,this.scene.camera.imagePlaneDist);return new n(this.scene.camera.cameraPosition,i.subV(l,this.scene.camera.cameraPosition))}getSamples(t,e,s,i,n){let a=[];for(let r=0;r<=3;r++)for(let o=0;o<=3;o++){let c=this.genCameraRayAA(t,e,s,i,n,r,o,4);c.direction.normalize(),a.push(c)}return a}render(){let t=this.canvas.getContext("2d"),e=this.canvas.clientWidth,s=this.canvas.clientHeight,n=t.getImageData(0,0,e,s),a=e/s;for(let t=0;t<s;t++)for(let r=0;r<e;r++){let o=new i(0,0,0);if(this.AA){let n=this.getSamples(r,t,a,e,s);for(let t of n){let e=0;o=i.addV(o,this.traceRay(t,0,e))}o=i.multiplyScalar(o,1/n.length)}else{let n=this.genCameraRay(r,t,a,e,s);n.direction.normalize();let c=0;o=i.addV(o,this.traceRay(n,0,c))}this.setPixelColor(o,n,r,t,e)}t.putImageData(n,0,0)}}},652:(t,e,s)=>{const i=s(677),n=s(336),a=s(435);t.exports=class{constructor(){this.objects=[],this.lights=[],this.backgroundColor=new a,this.camera=new n,this.ambient=new i}addObject(t){this.objects.push(t)}addLight(t){this.lights.push(t)}setBackgroundColor(t){this.backgroundColor=t}}},801:(t,e,s)=>{const i=s(435);t.exports=class{constructor(t=new i,e,s){this.center=t,this.radius=e,this.material=s}hit(t,e){let s=i.subV(t.origin,this.center),n=i.dotProduct(t.direction,t.direction),a=2*i.dotProduct(s,t.direction),r=a*a-4*n*(i.dotProduct(s,s)-this.radius*this.radius);if(r<0)return 1/0;let o=Math.sqrt(r),c=(-a-o)/(2*n);return c>e?c:(c=(-a+o)/(2*n),c>e?c:1/0)}}},435:t=>{class e{constructor(t,e,s){this.x=t,this.y=e,this.z=s}norm(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}normalize(){let t=this.norm();return this.x=this.x*(1/t),this.y=this.y*(1/t),this.z=this.z*(1/t),this}static multiplyScalar(t,s){return new e(t.x*s,t.y*s,t.z*s)}negate(){return new e(-this.x,-this.y,-this.z)}static dotProduct(t,e){return t.x*e.x+t.y*e.y+t.z*e.z}static addV(t,s){return new e(t.x+s.x,t.y+s.y,t.z+s.z)}static subV(t,s,i){return new e(t.x-s.x,t.y-s.y,t.z-s.z)}}t.exports=e}},e={};function s(i){var n=e[i];if(void 0!==n)return n.exports;var a=e[i]={exports:{}};return t[i](a,a.exports,s),a.exports}(()=>{const t=s(801),e=s(435),i=s(548),n=s(74),a=s(599),r=document.getElementById("canvas"),o=r.getContext("2d");o.fillStyle="black",o.fillRect(0,0,r.width,r.height);const c=new n(r);!function(){let s=new a(new e(102,102,76.5),50,.6,.3,.2,.1),n=new a(new e(76.5,25.5,25.5),10,.9,.1,.2,0),r=new a(new e(255,255,255),1425,0,10,.2,.8),o=new e(51.2,179.2,204.8),l=new t(new e(-3,0,-16),2,s),h=new t(new e(-1,-1.5,-12),2,r),d=new t(new e(1.5,-.5,-18),3,n),u=new t(new e(7,5,-18),4,r),m=new i(new e(-20,20,20),1.5),g=new i(new e(30,50,-25),1.8),w=new i(new e(30,20,30),1.7);c.scene.setBackgroundColor(o),c.scene.camera.setCameraPosition(new e(0,0,0)),c.scene.camera.setImagePlaneDistance(-1),c.scene.camera.setFOV(Math.PI/3),c.scene.addObject(l),c.scene.addObject(h),c.scene.addObject(d),c.scene.addObject(u),c.scene.addLight(m),c.scene.addLight(g),c.scene.addLight(w),c.scene.ambient.setIntensity(0),c.enableShadows(!0),c.setMaxReflectionDepth(4),c.enableAA(!0)}(),window.start=function(){c.render()}})()})();